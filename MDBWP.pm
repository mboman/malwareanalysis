package MDBWP;

use strict;
use warnings;

use WordPress::XMLRPC;

use MDBUtils;
use MDBAWS;

use Data::Dumper;

sub WPPost {
    print "MDBWP::WPPost()\n";

    my $title    = shift or die;
    my $config   = MDBUtils::get_config();
    my $metadata = MDBAWS::sdb_get_metadata($title);
    my $content;

    my $o = WordPress::XMLRPC->new(
        {
            username => $config->{'wordpress'}->{'username'},
            password => $config->{'wordpress'}->{'password'},
            proxy    => "http://"
              . $config->{'wordpress'}->{'host'} . "/"
              . $config->{'wordpress'}->{'path'}
              . "/xmlrpc.php"
        }
    );

    $o->server
      or die( sprintf 'could not connect with %s:%s to %s',
        $o->username, $o->password, $o->proxy );

    $content->{'categories'}             = ( ['Uncategorized'] );
    $content->{'mt_allow_comments'}      = 1;
    $content->{'title'}                  = $title;
    $content->{'userid'}                 = '1';
    $content->{'wp_author_display_name'} = 'Updatebot';
    $content->{'description'}            = 'Placeholder for wiki post';

    return($o->newPost( $content, 1 ));
}

1;
