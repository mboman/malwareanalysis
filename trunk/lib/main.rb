# 
# main.rb
# 
# Created on Oct 11, 2007, 7:17:35 AM
# 
# To change this template, choose Tools | Templates
# and open the template in the editor.
 

require "watir" # the Watir controller

website = "http://www.virustotal.com"
malware = "C\:\\cygwin\\home\\mboman\\malware\\Realshade.exe"
waiting = true

ie = Watir::IE.new
ie.goto website

# Set file to upload
ie.file_field(:name,  'archivo').set(malware) # Set the filename to the suspected file

# Set options
ie.checkbox(:name, "distribucion").set # Do not distribute the sample
ie.checkbox(:name, "envioseguro").set # Send sample over SSL

# Send the file for analysis
ie.button(:index, 1).click

# File being uploaded, wait for analysis to be complete
while (waiting == true)
  if ie.contains_text("finished") # Wait for the file to complete upload and scan
    waiting = false
  end
  if ie.contains_text("0 bytes size received")
    puts "Can't read the file \"" + malware + "\". Quitting...\n"
    exit
  end
end

puts "VirusScan complete"
# Copy the result from the analysis to the analyst's wiki (MediaWiki based)

wikiOutput = "== VirusTotal Scan Results =="
